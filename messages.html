	<script>
		// Ensure a Supabase client exists when opening this page standalone.
		(function(){
			try {
				const SUPABASE_URL = 'https://xgtnbxdxbbywvzrttixf.supabase.co';
				const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhndG5ieGR4YmJ5d3Z6cnR0aXhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0Nzg5NTAsImV4cCI6MjA3MjA1NDk1MH0.YGk0vFyIJEiSpu5phzV04Mh4lrHBlfYLFtPP_afFtMQ';

				// If the bundled supabase library is available as `supabase` namespace,
				// create a reusable client instance and expose it as `window.supabase`.
				if (window.supabase && typeof window.supabase.createClient === 'function') {
					try {
						const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
						client.supabaseKey = SUPABASE_KEY;
						window.supabase = client;
						if (!window.supabaseClient) window.supabaseClient = client;
						console.log('Supabase client initialized for messages.html');
					} catch (e) { console.warn('Could not create Supabase client', e); }
				} else if (window.supabase && typeof window.supabase.from === 'function') {
					// Already a client instance; ensure supabaseKey exists for code that references it
					try { if (!window.supabase.supabaseKey) window.supabase.supabaseKey = SUPABASE_KEY; } catch(e){}
				} else {
					// Library missing (network blocked or older browser). Messaging features will be limited.
					console.warn('Supabase library not found; messaging may be limited.');
				}
			} catch (err) { console.warn('Supabase init error', err); }
		})();
	</script>
	<script src="messages.js"></script>
	<script>
		// Ensure the UI shows the chats tab when this page opens standalone.
		document.addEventListener('DOMContentLoaded', () => {
			try {
				setTimeout(() => { if (window.crm && typeof window.crm.switchTab === 'function') window.crm.switchTab('chats'); }, 300);
			} catch (e) { console.warn('Post-load UI init failed', e); }
		});
	</script>
	<script>
		// Minimal switchMainView and tab helpers so fragments like #view-whatsapp work
		function switchMainView(viewId) {
			document.querySelectorAll('.view-section').forEach(v => { v.classList.add('hidden-force'); v.classList.add('hidden'); });
			var target = document.getElementById(viewId);
			if (!target) {
				if (viewId === 'view-facebook') target = document.getElementById('view-facebook-messenger');
				if (viewId === 'view-instagram') target = document.getElementById('view-instagram-direct');
			}
			if (target) { target.classList.remove('hidden-force'); target.classList.remove('hidden'); }

			// Show/hide persistent headers for FB/IG
			var fbHeader = document.getElementById('facebook-header');
			var igHeader = document.getElementById('instagram-header');
			var isFb = viewId && viewId.indexOf('facebook') !== -1;
			var isIg = viewId && viewId.indexOf('instagram') !== -1;
			if (fbHeader) { if (isFb) { fbHeader.classList.remove('hidden-force'); fbHeader.classList.remove('hidden'); } else { fbHeader.classList.add('hidden-force'); fbHeader.classList.add('hidden'); } }
			if (igHeader) { if (isIg) { igHeader.classList.remove('hidden-force'); igHeader.classList.remove('hidden'); } else { igHeader.classList.add('hidden-force'); igHeader.classList.add('hidden'); } }
		}

		function showFacebookTab(tab) {
			try {
				document.querySelectorAll('.facebook-view').forEach(v => v.classList.add('hidden'));
				var el = document.getElementById('facebook-' + tab);
				if (el) el.classList.remove('hidden');
			} catch (e) { }
		}

		function showInstagramTab(tab) {
			try {
				document.querySelectorAll('.instagram-view').forEach(v => v.classList.add('hidden'));
				var el = document.getElementById('instagram-' + tab);
				if (el) el.classList.remove('hidden');
			} catch (e) { }
		}

		// Handle fragment navigation when arriving from sidebar links
		document.addEventListener('DOMContentLoaded', () => {
			try {
				const hash = (location.hash || '').replace(/^#/, '');
				if (hash) {
					// Accept both plain names and view- prefixed ids
					const viewId = hash.indexOf('view-') === 0 ? hash : `view-${hash}`;
					setTimeout(() => switchMainView(viewId), 200);
				}
			} catch (e) { console.warn('Fragment navigation failed', e); }
		});
	</script>

				<div id="crm-tab-content" class="flex-1 overflow-hidden relative">
                    
					<div id="crm-chats" class="crm-view h-full flex gap-4 relative">
						<div id="crm-chat-list-panel" class="w-full md:w-1/3 lg:w-1/4 bg-[#1a1d23] border border-[#2b2f3a] rounded-xl flex flex-col h-full">
							<div class="p-4 border-b border-[#2b2f3a]">
								<div class="relative">
									<i class="fa-solid fa-search absolute left-3 top-3 text-white/30 text-xs"></i>
									<input type="text" placeholder="Search..." class="w-full bg-[#0f1115] rounded-lg pl-8 pr-3 py-2 text-sm text-white focus:outline-none border border-transparent">
								</div>
							</div>
							<div id="crm-contact-list" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
						</div>

						<div id="crm-chat-window" class="hidden md:flex flex-1 bg-[#1a1d23] border border-[#2b2f3a] rounded-xl flex-col h-full relative overflow-hidden">
							<div class="p-3 border-b border-[#2b2f3a] flex justify-between items-center bg-[#202c33] z-10">
								<div class="flex items-center gap-3">
									<button onclick="crm.closeMobileChat()" class="md:hidden text-white/70 mr-2"><i class="fa-solid fa-arrow-left"></i></button>
									<div class="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold relative">
										<span id="chat-header-avatar">?</span>
									</div>
									<div>
											<div class="font-bold text-sm cursor-pointer" id="chat-header-name" title="View contact">Select a contact</div>
										<div class="flex items-center gap-2">
											<div id="chat-header-indicator" class="w-2 h-2 rounded-full bg-gray-500"></div>
											<div class="text-xs text-white/50" id="chat-header-status">...</div>
										</div>
									</div>
								</div>
								<div class="flex items-center gap-3">
									<div class="flex items-center gap-2 mr-2 bg-white/5 px-3 py-1 rounded-full border border-white/10">
										<span class="text-xs text-white/60"><i class="fa-solid fa-robot mr-1"></i> Auto-Pilot</span>
										<button id="ai-toggle-btn" onclick="crm.toggleAI()" class="w-8 h-4 rounded-full bg-gray-600 relative transition-colors">
											<div class="w-2 h-2 bg-white rounded-full absolute top-1 left-1 transition-all"></div>
										</button>
									</div>
										<button id="contact-notes-btn" onclick="crm.openContactModal()" class="px-3 py-1 bg-white/5 hover:bg-white/10 text-xs rounded-md border border-white/10 flex items-center gap-2">
											<i class="fa-regular fa-note-sticky"></i>
											Notes
										</button>
								</div>
							</div>

							<div id="crm-messages-area" class="flex-1 overflow-y-auto p-4 space-y-3 bg-[#0b141a] chat-bg relative">
								<div class="flex h-full items-center justify-center text-white/30 text-sm flex-col">
									<i class="fa-brands fa-whatsapp text-4xl mb-3 opacity-50"></i>
									<p>Select a conversation</p>
								</div>
							</div>

							<div id="chat-input-container" class="p-3 bg-[#202c33] flex gap-2 items-center hidden">
								<input type="file" id="chat-file-upload" class="hidden" onchange="alert('File uploaded (Mock)')">
								<button onclick="document.getElementById('chat-file-upload').click()" class="text-white/50 hover:text-white p-2"><i class="fa-solid fa-paperclip"></i></button>
								<input type="text" id="chat-input" placeholder="Type a message..." class="flex-1 bg-[#2a3942] rounded-lg px-4 py-3 text-sm text-white focus:outline-none" onkeypress="if(event.key === 'Enter') crm.sendMessage()">
								<button onclick="crm.sendMessage()" class="p-3 bg-[#005c4b] hover:bg-[#005c4b]/80 rounded-full text-white w-10 h-10 flex items-center justify-center shadow-lg"><i class="fa-solid fa-paper-plane text-sm"></i></button>
							</div>
                            
							<div id="chat-input-disabled" class="p-4 bg-[#202c33] text-center text-xs text-white/40 border-t border-[#2b2f3a] hidden">
								<i class="fa-solid fa-robot mr-2"></i> AI Auto-Pilot is active. Turn off to type manually.
							</div>
						</div>
					</div>

					<div id="crm-lists" class="crm-view hidden-force h-full overflow-y-auto">
						<div id="lists-grid-view">
							<div class="bg-[#1a1d23] rounded-xl border border-[#2b2f3a] p-6">
								<div class="flex justify-between items-center mb-6">
									<h3 class="font-bold text-xl">Contact Lists</h3>
									<button onclick="crm.createNewList()" class="px-4 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg text-sm text-white font-medium">
										<i class="fa-solid fa-plus mr-2"></i> Create List
									</button>
								</div>
								<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="crm-lists-container"></div>
							</div>
						</div>

						<div id="lists-detail-view" class="hidden-force flex flex-col h-full bg-[#1a1d23] rounded-xl border border-[#2b2f3a] overflow-hidden">
							<div class="p-4 border-b border-[#2b2f3a] flex items-center justify-between bg-[#232730]">
								<div class="flex items-center gap-4">
									<button onclick="crm.closeListDetails()" class="text-white/60 hover:text-white"><i class="fa-solid fa-arrow-left"></i> Back</button>
									<div>
										<h3 class="font-bold text-lg" id="detail-list-name">List Name</h3>
										<div class="text-xs text-white/50 flex gap-3">
											<span id="detail-list-date">Created: ...</span>
											<span class="text-purple-400" id="detail-list-campaigns">Active: None</span>
										</div>
									</div>
								</div>
							</div>
							<div class="flex-1 overflow-auto">
								<table class="w-full text-left">
									<thead class="bg-[#14161a] text-xs uppercase text-white/50 sticky top-0">
										<tr>
											<th class="p-4">Name</th>
											<th class="p-4">Phone</th>
											<th class="p-4">Last Interaction</th>
											<th class="p-4">Status</th>
										</tr>
									</thead>
									<tbody id="detail-list-tbody" class="text-sm divide-y divide-[#2b2f3a]"></tbody>
								</table>
							</div>
						</div>
					</div>

					<div id="crm-campaigns" class="crm-view hidden-force h-full overflow-y-auto">
						 <div class="bg-[#1a1d23] rounded-xl border border-[#2b2f3a] p-6 mb-6">
							<div class="flex justify-between items-center mb-6">
								<h3 class="font-bold text-xl">Campaigns</h3>
								<button onclick="document.getElementById('campaign-modal').classList.remove('hidden-force')" class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-sm text-white font-medium">
									<i class="fa-solid fa-bullhorn mr-2"></i> New Campaign
								</button>
							</div>
							<table class="w-full text-left">
								<thead class="bg-[#232730] text-xs uppercase text-white/50">
									<tr>
										<th class="p-4 rounded-tl-lg">Name</th>
										<th class="p-4">List</th>
										<th class="p-4">Scheduled</th>
										<th class="p-4">Status</th>
										<th class="p-4 rounded-tr-lg">AI Assist</th>
									</tr>
								</thead>
								<tbody id="crm-campaigns-table" class="text-sm divide-y divide-[#2b2f3a]"></tbody>
							</table>
						</div>
					</div>

					<div id="crm-templates" class="crm-view hidden-force h-full overflow-y-auto">
						<div class="bg-[#1a1d23] rounded-xl border border-[#2b2f3a] p-6">
							<div class="flex justify-between items-center mb-6">
								<h3 class="font-bold text-xl">Message Templates</h3>
								<button onclick="crm.openTemplateModal()" class="px-4 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg text-sm text-white font-medium">
									<i class="fa-solid fa-plus mr-2"></i> New Template
								</button>
							</div>
							<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="crm-templates-container"></div>
						</div>
					</div>

					<div id="crm-settings" class="crm-view hidden-force absolute inset-0 flex flex-col p-4 bg-[#14161a] overflow-y-auto z-20">
						<div class="flex justify-between items-center mb-4">
							<h3 class="font-bold text-green-500">WhatsApp Configuration</h3>
							<button onclick="crm.switchTab('chats')" class="text-white/40 hover:text-white" title="Close settings"><i class="fa-solid fa-times"></i></button>
						</div>
                        
						<div class="mb-6">
							<label class="text-xs font-bold text-white/40 uppercase">AI Identity</label>
							<textarea id="wa-system-prompt" class="w-full bg-black/20 border border-white/10 rounded-lg p-2 text-sm mt-1 focus:border-green-500 outline-none" rows="4" placeholder="You are a helpful assistant..."></textarea>
						</div>

						<div class="space-y-3">
							<label class="text-xs font-bold text-white/40 uppercase">API Credentials</label>
							<div>
								<input id="wa-phone-id" type="text" placeholder="Phone Number ID" class="w-full bg-black/20 border border-white/10 rounded p-2 text-sm">
							</div>
							<div>
								<input id="wa-waba-id" type="text" placeholder="WABA ID" class="w-full bg-black/20 border border-white/10 rounded p-2 text-sm">
							</div>
							<div class="relative">
								<input id="wa-token" type="password" placeholder="Permanent Access Token" class="w-full bg-black/20 border border-white/10 rounded p-2 text-sm pr-8">
								<i onclick="togglePass('wa-token')" class="fa-solid fa-eye absolute right-3 top-3 text-white/30 cursor-pointer hover:text-white"></i>
							</div>
						</div>

						<button onclick="crm.saveSettings('whatsapp')" class="mt-6 w-full py-2 bg-green-600 hover:bg-green-500 rounded-lg font-medium text-sm">Save WhatsApp Settings</button>
					</div>

					 <div id="crm-analytics" class="crm-view hidden-force h-full overflow-y-auto">
						<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
							<div class="bg-[#1a1d23] p-6 rounded-2xl border border-[#2b2f3a]">
								<div class="text-white/50 text-sm mb-1 uppercase tracking-wider">Messages Sent</div>
								<div class="text-3xl font-bold text-white" id="stat-sent">0</div>
							</div>
							<div class="bg-[#1a1d23] p-6 rounded-2xl border border-[#2b2f3a]">
								<div class="text-white/50 text-sm mb-1 uppercase tracking-wider">Read Rate</div>
								<div class="text-3xl font-bold text-blue-400" id="stat-read">0%</div>
							</div>
							<div class="bg-[#1a1d23] p-6 rounded-2xl border border-[#2b2f3a]">
								<div class="text-white/50 text-sm mb-1 uppercase tracking-wider">AI Replied</div>
								<div class="text-3xl font-bold text-purple-400" id="stat-ai">0</div>
							</div>
						</div>
					</div>

				</div>
			</div>

			<div id="facebook-header" class="hidden h-20 border-b border-white/10 flex flex-col justify-center px-6 bg-[#18191a]">
				<div class="flex items-center justify-between mb-2">
					<div class="flex items-center gap-3">
						<div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center">
							<i class="fa-brands fa-facebook-f text-white"></i>
						</div>
						<h2 class="text-lg font-semibold">Inbox</h2>
					</div>
					<div class="flex items-center gap-3">
						<div id="fb-ai-indicator" class="hidden text-xs text-white/60 flex items-center gap-2">
							<i class="fa-solid fa-robot text-yellow-400"></i> AI
						</div>
						<div id="fb-timer" class="text-xs text-white/50"></div>
					</div>
				</div>

				<div class="flex gap-3">
					<button onclick="switchMainView('view-facebook-messenger'); showFacebookTab('inbox')" id="fb-tab-inbox" class="facebook-tab-btn active pb-2 border-b-2 border-blue-500 text-white font-medium whitespace-nowrap">Inbox</button>
					<span id="fb-unread-total" class="ml-2 text-xs text-blue-400 hidden"></span>
					<button onclick="switchMainView('view-facebook-comments'); showFacebookTab('comments')" id="fb-tab-comments" class="facebook-tab-btn pb-2 border-b-2 border-transparent text-white/60 hover:text-white whitespace-nowrap">Comments</button>
				</div>
			</div>

			<div id="view-facebook-messenger" class="view-section hidden h-full flex flex-col">
				<div class="flex-1 flex overflow-hidden">
					<div class="w-80 border-r border-white/10 flex flex-col bg-[#18191a]">
							<div class="p-4">
							<input id="fb-search" type="text" placeholder="Search Messenger..." class="w-full bg-[#242526] text-white text-sm px-4 py-2 rounded-full focus:outline-none border border-transparent focus:border-blue-500">
						</div>
						<div id="fb-conversation-list" class="flex-1 overflow-y-auto">
							<div class="p-3 mx-2 rounded-lg hover:bg-white/5 cursor-pointer flex gap-3 items-center conv-item" data-last-customer-timestamp="2026-01-21T12:00:00Z">
								<img src="https://ui-avatars.com/api/?name=John+Doe&background=0D8ABC&color=fff" class="w-10 h-10 rounded-full">
								<div class="flex-1 min-w-0">
									<div class="flex justify-between">
										<h4 class="font-semibold text-sm truncate">John Doe</h4>
										<span class="text-xs text-white/40">12:30 PM</span>
									</div>
									<p class="text-xs text-white/60 truncate last-customer-msg">Is this still available?</p>
								</div>
							</div>
						</div>
					</div>
					<div class="flex-1 flex flex-col bg-[#0f1115] relative">
						<div class="h-16 border-b border-white/10 flex justify-between items-center px-4 bg-[#0f1115]">
							<h2 class="text-lg font-semibold">Messages</h2>
							<button onclick="crm.toggleSocialSettings('facebook')" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-white/60">
								<i class="fa-solid fa-gear"></i>
							</button>
						</div>
						<div id="fb-window-warning" class="hidden bg-yellow-500/10 border-b border-yellow-500/20 px-4 py-2 flex items-center justify-between">
							<span class="text-xs text-yellow-200"><i class="fa-regular fa-clock mr-2"></i> 24h Window closes in <strong>2 hours</strong>.</span>
							<button class="text-xs bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-200 px-2 py-1 rounded">Use Tag</button>
						</div>
						<div id="fb-messages-area" class="flex-1 overflow-y-auto p-4 space-y-4">
							<div class="flex gap-2 max-w-[70%]">
								<img src="https://ui-avatars.com/api/?name=John+Doe" class="w-8 h-8 rounded-full mt-1">
								<div class="bg-[#242526] p-3 rounded-2xl rounded-tl-none text-sm text-white/90">
									Hi, I saw your ad on Facebook.
								</div>
							</div>
							<div class="flex gap-2 max-w-[70%] ml-auto flex-row-reverse">
								<div class="bg-blue-600 p-3 rounded-2xl rounded-tr-none text-sm text-white">
									Hello! Yes, checking availability now.
								</div>
							</div>
						</div>
						<div id="fb-send-bar" class="p-4 border-t border-white/10 bg-[#18191a]">
							<div class="flex gap-2">
								<button class="p-2 text-blue-500 hover:bg-white/5 rounded-full"><i class="fa-solid fa-circle-plus text-xl"></i></button>
								<input id="fb-send-input" type="text" placeholder="Type a message..." class="flex-1 bg-transparent text-white focus:outline-none px-2">
								<button id="fb-send-btn" class="p-2 text-blue-500 hover:bg-white/5 rounded-full"><i class="fa-solid fa-paper-plane text-xl"></i></button>
							</div>
						</div>
                        
						<div id="settings-facebook" class="hidden absolute top-16 left-0 w-80 bottom-0 bg-[#14161a] border-r border-white/10 z-30 p-4 overflow-y-auto">
							<div class="flex justify-between items-center mb-4">
								<h3 class="font-bold text-blue-500">Page Settings</h3>
								<button onclick="crm.toggleSocialSettings('facebook')" class="text-white/40 hover:text-white"><i class="fa-solid fa-times"></i></button>
							</div>

							<div class="mb-6">
								<label class="text-xs font-bold text-white/40 uppercase">AI Tone</label>
								<textarea id="fb-ai-config" class="w-full bg-black/20 border border-white/10 rounded-lg p-2 text-sm mt-1 focus:border-blue-500 outline-none" rows="3" placeholder="Be professional and concise..."></textarea>
							</div>

							<div class="space-y-3">
								<label class="text-xs font-bold text-white/40 uppercase">Graph API</label>
								<input id="fb-page-id" type="text" placeholder="Page ID" class="w-full bg-black/20 border border-white/10 rounded p-2 text-sm">
								<div class="relative">
									<input id="fb-token" type="password" placeholder="Page Access Token" class="w-full bg-black/20 border border-white/10 rounded p-2 text-sm pr-8">
									<i onclick="togglePass('fb-token')" class="fa-solid fa-eye absolute right-3 top-3 text-white/30 cursor-pointer hover:text-white"></i>
								</div>
							</div>
							<button onclick="crm.saveSettings('facebook')" class="mt-6 w-full py-2 bg-blue-600 hover:bg-blue-500 rounded-lg font-medium text-sm">Save Page Settings</button>
						</div>
					</div>
				</div>
			</div>
			<div id="view-facebook-comments" class="view-section hidden h-full flex flex-col">
				<div class="flex-1 flex overflow-hidden">
					<div class="w-1/3 border-r border-white/10 overflow-y-auto bg-[#18191a]">
						<div class="p-4 border-b border-white/5 hover:bg-white/5 cursor-pointer flex gap-3">
							<div class="w-16 h-16 bg-gray-700 rounded-md bg-cover bg-center" style="background-image: url('https://via.placeholder.com/150')"></div>
							<div class="flex-1">
								<h4 class="text-sm font-medium text-white/90 line-clamp-2">New Summer Collection requires the best logic...</h4>
								<div class="mt-2 flex items-center gap-2 text-xs text-white/50">
									<span class="text-blue-400 font-bold">2 new</span>
									<span>• 5 total</span>
									<span>• 10m ago</span>
								</div>
							</div>
						</div>
					</div>
					<div class="flex-1 overflow-y-auto bg-[#0f1115] p-6">
						<div class="bg-[#242526] rounded-lg p-4 mb-6 border border-white/5">
							<div class="flex gap-3 mb-3">
								<div class="w-10 h-10 bg-gray-600 rounded-full"></div>
								<div>
									<div class="font-bold text-sm">VVStudios Page</div>
									<div class="text-xs text-white/40">Posted on Jan 20</div>
								</div>
							</div>
							<p class="text-white/80 text-sm mb-3">Here is the detailed post content that users are commenting on.</p>
							<img src="https://via.placeholder.com/600x300" class="rounded-lg w-full object-cover h-48">
						</div>
						<div class="space-y-4 pl-4 border-l-2 border-white/10 ml-2">
							<div class="group">
								<div class="flex gap-3">
									<img src="https://ui-avatars.com/api/?name=User+One" class="w-8 h-8 rounded-full">
									<div class="flex-1">
										<div class="bg-[#242526] px-4 py-2 rounded-2xl rounded-tl-none inline-block">
											<span class="font-bold text-xs block text-white/60 mb-1">User One</span>
											<p class="text-sm">How much does this service cost?</p>
										</div>
										<div class="flex gap-3 mt-1 ml-2 text-xs text-white/40">
											<button class="hover:text-blue-400">Like</button>
											<button class="hover:text-blue-400">Reply Publicly</button>
											<button class="hover:text-yellow-400"><i class="fa-regular fa-paper-plane"></i> DM Privately</button>
											<button class="hover:text-red-400">Hide</button>
										</div>
									</div>
								</div>
                                
								<div class="hidden ml-11 mt-2 flex gap-2">
									<input type="text" class="bg-white/5 border border-white/10 rounded-full px-4 py-1 text-sm w-full focus:border-blue-500 focus:outline-none" placeholder="Write a reply...">
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div id="instagram-header" class="hidden h-20 border-b border-white/10 flex flex-col justify-center px-6 bg-[#18191a]">
				<div class="flex items-center justify-between mb-2">
					<div class="flex items-center gap-3">
						<div class="w-8 h-8 rounded-full bg-gradient-to-tr from-yellow-400 to-pink-600 flex items-center justify-center">
							<i class="fa-brands fa-instagram text-white"></i>
						</div>
						<h2 class="text-lg font-semibold">Direct Messages</h2>
					</div>
					<div class="flex items-center gap-3">
						<div id="ig-ai-indicator" class="hidden text-xs text-white/60 flex items-center gap-2">
							<i class="fa-solid fa-robot text-yellow-400"></i> AI
						</div>
						<div id="ig-timer" class="text-xs text-white/50"></div>
					</div>
				</div>

				<div class="flex gap-3">
					<button onclick="switchMainView('view-instagram-direct'); showInstagramTab('dm')" id="ig-tab-dm" class="instagram-tab-btn active pb-2 border-b-2 border-pink-500 text-white font-medium whitespace-nowrap">DM</button>
					<span id="ig-unread-total" class="ml-2 text-xs text-pink-400 hidden"></span>
					<button onclick="switchMainView('view-instagram-comments'); showInstagramTab('activity')" id="ig-tab-activity" class="instagram-tab-btn pb-2 border-b-2 border-transparent text-white/60 hover:text-white whitespace-nowrap">Activity</button>
				</div>
			</div>

			<div id="view-instagram-direct" class="view-section hidden h-full flex flex-col">
				<div class="flex-1 flex overflow-hidden">
					<div class="w-80 border-r border-white/10 flex flex-col bg-[#18191a]">
						<div class="p-4">
							<input id="ig-search" type="text" placeholder="Search Direct..." class="w-full bg-[#242526] text-white text-sm px-4 py-2 rounded-full focus:outline-none border border-transparent focus:border-pink-500">
						</div>
						<div id="ig-conversation-list" class="flex-1 overflow-y-auto">
							<div class="p-3 mx-2 rounded-lg hover:bg-white/5 cursor-pointer flex gap-3 items-center conv-item" data-last-customer-timestamp="2026-01-21T13:15:00Z">
								<img src="https://ui-avatars.com/api/?name=Jane+Doe&background=E91E63&color=fff" class="w-10 h-10 rounded-full">
								<div class="flex-1 min-w-0">
									<div class="flex justify-between">
										<h4 class="font-semibold text-sm truncate">Jane Doe</h4>
										<span class="text-xs text-white/40">1:15 PM</span>
									</div>
									<p class="text-xs text-white/60 truncate last-customer-msg">Love your posts!</p>
								</div>
							</div>
						</div>
					</div>
					<div class="flex-1 flex flex-col bg-[#0f1115] relative">
						<div class="h-16 border-b border-white/10 flex justify-between items-center px-4 bg-[#0f1115]">
							<h2 class="text-lg font-semibold">Direct Messages</h2>
							<button onclick="crm.toggleSocialSettings('instagram')" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-white/60">
								<i class="fa-solid fa-gear"></i>
							</button>
						</div>
						<div id="ig-window-warning" class="hidden bg-yellow-500/10 border-b border-yellow-500/20 px-4 py-2 flex items-center justify-between">
							<span class="text-xs text-yellow-200"><i class="fa-regular fa-clock mr-2"></i> 24h Window closes in <strong>1 hour</strong>.</span>
							<button class="text-xs bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-200 px-2 py-1 rounded">Use Tag</button>
						</div>
						<div id="ig-messages-area" class="flex-1 overflow-y-auto p-4 space-y-4">
							<div class="flex gap-2 max-w-[70%]">
								<img src="https://ui-avatars.com/api/?name=Jane+Doe" class="w-8 h-8 rounded-full mt-1">
								<div class="bg-[#242526] p-3 rounded-2xl rounded-tl-none text-sm text-white/90">
									Hi, I saw your story on Instagram.
								</div>
							</div>
							<div class="flex gap-2 max-w-[70%] ml-auto flex-row-reverse">
								<div class="bg-gradient-to-tr from-yellow-400 to-pink-600 p-3 rounded-2xl rounded-tr-none text-sm text-white">
									Thanks! How can I help?
								</div>
							</div>
						</div>
						<div id="ig-send-bar" class="p-4 border-t border-white/10 bg-[#18191a]">
							<div class="flex gap-2">
								<button class="p-2 text-pink-500 hover:bg-white/5 rounded-full"><i class="fa-solid fa-circle-plus text-xl"></i></button>
								<input id="ig-send-input" type="text" placeholder="Type a message..." class="flex-1 bg-transparent text-white focus:outline-none px-2">
								<button id="ig-send-btn" class="p-2 text-pink-500 hover:bg-white/5 rounded-full"><i class="fa-solid fa-paper-plane text-xl"></i></button>
							</div>
						</div>
                        
						<div id="settings-instagram" class="hidden absolute top-16 left-0 w-80 bottom-0 bg-[#14161a] border-r border-white/10 z-30 p-4 overflow-y-auto">
							<div class="flex justify-between items-center mb-4">
								<h3 class="font-bold text-pink-500">Instagram Settings</h3>
								<button onclick="crm.toggleSocialSettings('instagram')" class="text-white/40 hover:text-white"><i class="fa-solid fa-times"></i></button>
							</div>

							<div class="mb-6">
								<label class="text-xs font-bold text-white/40 uppercase">AI Style</label>
								<textarea id="ig-ai-config" class="w-full bg-black/20 border border-white/10 rounded-lg p-2 text-sm mt-1 focus:border-pink-500 outline-none" rows="3" placeholder="Use emojis, be visual..."></textarea>
							</div>

							<div class="space-y-3">
								<label class="text-xs font-bold text-white/40 uppercase">Graph API</label>
								<input id="ig-account-id" type="text" placeholder="Instagram Account ID" class="w-full bg-black/20 border border-white/10 rounded p-2 text-sm">
								<div class="relative">
									<input id="ig-token" type="password" placeholder="Access Token" class="w-full bg-black/20 border border-white/10 rounded p-2 text-sm pr-8">
									<i onclick="togglePass('ig-token')" class="fa-solid fa-eye absolute right-3 top-3 text-white/30 cursor-pointer hover:text-white"></i>
								</div>
							</div>
							<button onclick="crm.saveSettings('instagram')" class="mt-6 w-full py-2 bg-pink-600 hover:bg-pink-500 rounded-lg font-medium text-sm">Save Instagram Settings</button>
						</div>
					</div>

	</main>

	<script>
		// Ensure a Supabase client exists when opening this page standalone.
		(function(){
			try {
				const SUPABASE_URL = 'https://xgtnbxdxbbywvzrttixf.supabase.co';
				const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhndG5ieGR4YmJ5d3Z6cnR0aXhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0Nzg5NTAsImV4cCI6MjA3MjA1NDk1MH0.YGk0vFyIJEiSpu5phzV04Mh4lrHBlfYLFtPP_afFtMQ';

				// If the global is the library (has createClient), create a client and assign it.
				if (window.supabase && typeof window.supabase.createClient === 'function') {
					try {
						const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
						// attach key so existing code that reads supabaseKey works
						client.supabaseKey = SUPABASE_KEY;
						// expose as the global supabase client for messages.js compatibility
						window.supabase = client;
						if (!window.supabaseClient) window.supabaseClient = client;
						console.log('Supabase client initialized for messages.html');
					} catch (e) { console.warn('Could not create Supabase client', e); }
				} else if (window.supabase && typeof window.supabase.from === 'function') {
					// Already a client instance (rare); ensure supabaseKey exists
					try { if (!window.supabase.supabaseKey) window.supabase.supabaseKey = SUPABASE_KEY; } catch(e){}
				} else {
					console.warn('Supabase library not found; messaging may be limited.');
				}
			} catch (err) { console.warn('Supabase init error', err); }
		})();
	</script>
	<script src="messages.js"></script>
</body>
</html>

