<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Messages - VV Studios</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f1115; color: white; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background-color: transparent; }
        ::-webkit-scrollbar-thumb { background-color: #374151; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #4b5563; }

        /* Navigation Animations */
        .nav-item { position: relative; transition: color 0.3s; }
        .nav-item::after {
            content: ''; position: absolute; bottom: -18px; left: 0; width: 100%; height: 3px;
            background-color: transparent; transition: background-color 0.3s; border-radius: 3px 3px 0 0;
        }
        .nav-item.active::after { background-color: currentColor; }

        .sub-nav-item { position: relative; padding-bottom: 8px; color: #9ca3af; transition: all 0.2s; }
        .sub-nav-item:hover { color: white; }
        .sub-nav-item.active { color: white; font-weight: 600; }
        .sub-nav-item.active::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px;
            background-color: #a855f7; /* Default Purple */
        }

        /* Platform Specific Accent Colors for Sub-Nav underline */
        .platform-whatsapp .sub-nav-item.active::after { background-color: #22c55e; }
        .platform-facebook .sub-nav-item.active::after { background-color: #3b82f6; }
        .platform-instagram .sub-nav-item.active::after { background: linear-gradient(90deg, #f09433, #bc1888); }
        .platform-tiktok .sub-nav-item.active::after { background-color: #2dd4bf; }

        /* Utility */
        .hidden-force { display: none !important; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Mobile Chat Window Overlay */
        @media (max-width: 768px) {
            .mobile-chat-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 50;
                background-color: #1a1d23;
                border: none;
                border-radius: 0;
                width: 100%;
                height: 100%;
                max-height: none;
            }

            .mobile-chat-overlay.hidden {
                display: none !important;
            }

            .mobile-chat-list-hidden {
                display: none !important;
            }

            .mobile-close-btn {
                display: flex !important;
            }

            /* On mobile, hide chat list when a chat is open */
            #crm-chats .mobile-chat-list-hidden {
                display: none !important;
            }

            #view-facebook .mobile-chat-list-hidden {
                display: none !important;
            }

            #view-instagram .mobile-chat-list-hidden {
                display: none !important;
            }

            #view-tiktok .mobile-chat-list-hidden {
                display: none !important;
            }
        }

        @media (min-width: 769px) {
            .mobile-close-btn {
                display: none !important;
            }

            .mobile-chat-overlay {
                position: relative !important;
                top: auto !important;
                left: auto !important;
                right: auto !important;
                bottom: auto !important;
                z-index: auto !important;
                width: 100% !important;
                height: 100% !important;
                max-height: none !important;
            }

            .mobile-chat-list-hidden {
                display: block !important;
            }
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-[#0f1115]">

    <script>
        (function(){
            try {
                const SUPABASE_URL = 'https://xgtnbxdxbbywvzrttixf.supabase.co';
                const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhndG5ieGR4YmJ5d3Z6cnR0aXhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0Nzg5NTAsImV4cCI6MjA3MjA1NDk1MH0.YGk0vFyIJEiSpu5phzV04Mh4lrHBlfYLFtPP_afFtMQ';

                if (window.supabase && typeof window.supabase.createClient === 'function') {
                    const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                    client.supabaseKey = SUPABASE_KEY;
                    window.supabase = client;
                    if (!window.supabaseClient) window.supabaseClient = client;
                    console.log('Supabase client initialized.');
                } else {
                     // Fallback if library isn't loaded yet, try to load it or set config
                    window.supabaseUrl = SUPABASE_URL;
                    window.supabaseKey = SUPABASE_KEY;
                }
            } catch (err) { console.warn('Supabase init error', err); }
        })();
    </script>

    <!-- Temporary business ID for testing -->
    <script>
        window.businessId = 'kisasacraft66';
    </script>

    <script src="messages.js"></script>

    <script>
        // State Management
        let currentPlatform = 'whatsapp';
        let currentTab = 'livechat';

        function switchPlatform(platform) {
            currentPlatform = platform;
            
            // 1. Update Top Nav Styles
            document.querySelectorAll('.top-nav-btn').forEach(btn => {
                btn.classList.remove('bg-[#2b2f3a]', 'text-white', 'shadow-md');
                btn.classList.add('text-white/50', 'hover:bg-[#1a1d23]');
            });
            const activeBtn = document.getElementById(`btn-${platform}`);
            if(activeBtn) {
                activeBtn.classList.remove('text-white/50', 'hover:bg-[#1a1d23]');
                activeBtn.classList.add('bg-[#2b2f3a]', 'text-white', 'shadow-md');
            }

            // 2. Show Correct Sub-Nav Bar
            document.querySelectorAll('.sub-nav-container').forEach(el => el.classList.add('hidden'));
            const activeSubNav = document.getElementById(`subnav-${platform}`);
            if(activeSubNav) activeSubNav.classList.remove('hidden');

            // 3. Update Body Class for Colors
            document.body.className = `h-screen flex flex-col overflow-hidden bg-[#0f1115] platform-${platform}`;

            // 4. Default to first tab of that platform (usually Livechat/DMs)
            const defaultTab = platform === 'whatsapp' ? 'livechat' : 'dms';
            switchTab(defaultTab);
        }

        function switchTab(tab) {
            currentTab = tab;

            // Special handling for AI Playground
            if(tab === 'ai-playground') {
                // Deselect all platform buttons
                document.querySelectorAll('.top-nav-btn').forEach(btn => {
                    btn.classList.remove('bg-[#2b2f3a]', 'text-white', 'shadow-md');
                    btn.classList.add('text-white/50', 'hover:bg-[#1a1d23]');
                });
                // Highlight AI Lab button
                const aiLabBtn = document.getElementById('nav-ai-playground');
                if(aiLabBtn) {
                    aiLabBtn.classList.add('bg-[#2b2f3a]', 'text-white', 'shadow-md');
                    aiLabBtn.classList.remove('text-white/50', 'hover:bg-[#1a1d23]');
                }
                // Hide subnav for AI playground
                document.querySelectorAll('.sub-nav-container').forEach(el => el.classList.add('hidden'));
                // Hide all views
                document.querySelectorAll('.view-section').forEach(el => {
                    el.classList.add('hidden');
                    el.classList.add('hidden-force');
                });
                // Show AI playground
                const aiView = document.getElementById('view-ai-playground');
                if(aiView) {
                    aiView.classList.remove('hidden');
                    aiView.classList.remove('hidden-force');
                }
                // Load AI data
                if(window.aiManager) window.aiManager.loadMyBusinessPrompt();
                return;
            }

            // Show subnav for platform tabs
            document.querySelectorAll('.sub-nav-container').forEach(el => el.classList.add('hidden'));
            const activeSubNav = document.getElementById(`subnav-${currentPlatform}`);
            if(activeSubNav) activeSubNav.classList.remove('hidden');

            // 1. Update Sub-Nav Styles
            document.querySelectorAll('.sub-nav-item').forEach(el => el.classList.remove('active'));
            // Select buttons that link to this tab within the current visible subnav
            const activeBtns = document.querySelectorAll(`button[onclick="switchTab('${tab}')"]`);
            activeBtns.forEach(btn => {
                // Only highlight if it's inside the visible container
                if(!btn.closest('.hidden')) btn.classList.add('active');
            });

            // 2. Show Content
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.add('hidden');
                el.classList.add('hidden-force');
            });

            // Logic for mapping tabs to views
            if(tab === 'livechat' || tab === 'dms') {
                if(currentPlatform === 'whatsapp') {
                    document.getElementById('crm-chats').classList.remove('hidden');
                    document.getElementById('crm-chats').classList.remove('hidden-force');
                    if(window.crm) window.crm.renderContacts();
                } else if(currentPlatform === 'facebook') {
                    document.getElementById('view-facebook').classList.remove('hidden');
                    document.getElementById('view-facebook').classList.remove('hidden-force');
                    if(window.crm) window.crm.renderSocialMessenger('facebook');
                } else if(currentPlatform === 'instagram') {
                    document.getElementById('view-instagram').classList.remove('hidden');
                    document.getElementById('view-instagram').classList.remove('hidden-force');
                    if(window.crm) window.crm.renderSocialMessenger('instagram');
                } else if(currentPlatform === 'tiktok') {
                    document.getElementById('view-tiktok').classList.remove('hidden');
                    document.getElementById('view-tiktok').classList.remove('hidden-force');
                    if(window.crm) window.crm.renderSocialMessenger('tiktok');
                }
            } else if(tab === 'comments') {
                if(currentPlatform === 'facebook') {
                    document.getElementById('view-facebook-comments').classList.remove('hidden');
                    document.getElementById('view-facebook-comments').classList.remove('hidden-force');
                    if(window.crm) window.crm.renderCommentFeed('facebook');
                } else if(currentPlatform === 'instagram') {
                    document.getElementById('view-instagram-comments').classList.remove('hidden');
                    document.getElementById('view-instagram-comments').classList.remove('hidden-force');
                    if(window.crm) window.crm.renderCommentFeed('instagram');
                } else if(currentPlatform === 'tiktok') {
                    document.getElementById('view-tiktok-comments').classList.remove('hidden');
                    document.getElementById('view-tiktok-comments').classList.remove('hidden-force');
                    if(window.crm) window.crm.renderCommentFeed('tiktok');
                }
            } else {
                // Show placeholder for other sections
                const specificView = document.getElementById(`view-${tab}`);
                if(specificView) {
                    specificView.classList.remove('hidden');
                    specificView.classList.remove('hidden-force');
                } else {
                    document.getElementById('view-placeholder').classList.remove('hidden');
                    document.getElementById('view-placeholder').classList.remove('hidden-force');
                }
            }

            // Optional: Notify messages.js if it exists
            if(window.crm && window.crm.setPlatform) {
                window.crm.setPlatform(currentPlatform);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            switchPlatform('whatsapp'); // Init
        });
    </script>

    <div class="bg-[#1a1d23] border-b border-[#2b2f3a] px-4 pt-3 pb-3 flex items-center justify-between z-50">
        <div class="flex items-center gap-2">
            <div class="flex bg-[#0f1115] p-1 rounded-lg border border-[#2b2f3a]">
                <button id="btn-whatsapp" onclick="switchPlatform('whatsapp')" class="top-nav-btn px-4 py-2 rounded-md flex items-center gap-2 transition-all text-sm font-medium relative">
                    <i class="fa-brands fa-whatsapp text-green-500 text-lg"></i> <span class="hidden md:inline">WhatsApp</span>
                    <span id="whatsapp-unread-badge" class="absolute -top-1 -right-1 bg-green-500 text-white text-[10px] px-1.5 py-0.5 rounded-full font-bold hidden z-10 min-w-5 text-center">0</span>
                </button>
                <button id="btn-facebook" onclick="switchPlatform('facebook')" class="top-nav-btn px-4 py-2 rounded-md flex items-center gap-2 transition-all text-sm font-medium text-white/50 relative">
                    <i class="fa-brands fa-facebook text-blue-600 text-lg"></i> <span class="hidden md:inline">Facebook</span>
                    <span id="facebook-unread-badge" class="absolute -top-1 -right-1 bg-blue-500 text-white text-[10px] px-1 py-0.5 rounded-full font-bold hidden z-10 h-5 w-5 flex items-center justify-center">0</span>
                </button>
                <button id="btn-instagram" onclick="switchPlatform('instagram')" class="top-nav-btn px-4 py-2 rounded-md flex items-center gap-2 transition-all text-sm font-medium text-white/50 relative">
                    <i class="fa-brands fa-instagram text-pink-500 text-lg"></i> <span class="hidden md:inline">Instagram</span>
                    <span id="instagram-unread-badge" class="absolute -top-1 -right-1 bg-pink-500 text-white text-[10px] px-1 py-0.5 rounded-full font-bold hidden z-10 h-5 w-5 flex items-center justify-center">0</span>
                </button>
                <button id="btn-tiktok" onclick="switchPlatform('tiktok')" class="top-nav-btn px-4 py-2 rounded-md flex items-center gap-2 transition-all text-sm font-medium text-white/50 relative">
                    <i class="fa-brands fa-tiktok text-white text-lg"></i> <span class="hidden md:inline">TikTok</span>
                    <span id="tiktok-unread-badge" class="absolute -top-1 -right-1 bg-cyan-500 text-white text-[10px] px-1 py-0.5 rounded-full font-bold hidden z-10 h-5 w-5 flex items-center justify-center">0</span>
                </button>
                <button onclick="switchTab('ai-playground')" id="nav-ai-playground" class="nav-item w-full flex items-center gap-3 px-3 py-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg transition-colors group">
    <div class="w-5 h-5 flex items-center justify-center text-purple-400 group-hover:scale-110 transition-transform">
        <i class="fa-solid fa-flask"></i>
    </div>
    <span class="text-sm font-medium">AI Lab</span>
</button>
            </div>
        </div>
        
        <div class="flex items-center gap-3">
             <button class="w-9 h-9 rounded-full bg-[#2b2f3a] text-white/70 hover:text-white hover:bg-[#374151] flex items-center justify-center transition">
                <i class="fa-solid fa-bell"></i>
             </button>
             <button class="w-9 h-9 rounded-full bg-[#2b2f3a] text-white/70 hover:text-white hover:bg-[#374151] flex items-center justify-center transition">
                <i class="fa-solid fa-gear"></i>
             </button>
        </div>
    </div>

    <div class="bg-[#1a1d23] border-b border-[#2b2f3a] px-6">
        
        <div id="subnav-whatsapp" class="sub-nav-container flex gap-6 text-sm font-medium overflow-x-auto scrollbar-hide">
            <button onclick="switchTab('livechat')" class="sub-nav-item active py-3">Livechat</button>
            <button onclick="switchTab('lists')" class="sub-nav-item py-3">Lists</button>
            <button onclick="switchTab('campaigns')" class="sub-nav-item py-3">Campaigns</button>
            <button onclick="switchTab('templates')" class="sub-nav-item py-3">Templates</button>
            <button onclick="switchTab('preferences')" class="sub-nav-item py-3">Preferences</button>
        </div>

        <div id="subnav-facebook" class="sub-nav-container flex gap-6 text-sm font-medium hidden overflow-x-auto scrollbar-hide">
            <button onclick="switchTab('dms')" class="sub-nav-item active py-3">DMs</button>
            <button onclick="switchTab('comments')" class="sub-nav-item py-3">Comments</button>
            <button onclick="switchTab('preferences')" class="sub-nav-item py-3">Preferences</button>
        </div>

        <div id="subnav-instagram" class="sub-nav-container flex gap-6 text-sm font-medium hidden overflow-x-auto scrollbar-hide">
            <button onclick="switchTab('dms')" class="sub-nav-item active py-3">DMs</button>
            <button onclick="switchTab('comments')" class="sub-nav-item py-3">Comments</button>
            <button onclick="switchTab('preferences')" class="sub-nav-item py-3">Preferences</button>
        </div>

        <div id="subnav-tiktok" class="sub-nav-container flex gap-6 text-sm font-medium hidden overflow-x-auto scrollbar-hide">
            <button onclick="switchTab('dms')" class="sub-nav-item active py-3">DMs</button>
            <button onclick="switchTab('comments')" class="sub-nav-item py-3">Comments</button>
            <button onclick="switchTab('preferences')" class="sub-nav-item py-3">Preferences</button>
        </div>

    </div>

    <div id="crm-tab-content" class="flex-1 overflow-hidden relative flex flex-col h-full p-4 md:p-6">
        
        <!-- WhatsApp Livechat Section -->
        <div id="crm-chats" class="view-section flex flex-1 overflow-hidden relative">
    
    <div id="crm-chat-list-panel" class="w-full md:w-80 border-r border-white/10 flex flex-col bg-[#111318]">
        <div class="p-4 border-b border-white/5">
            <div class="relative">
                <i class="fa-solid fa-search absolute left-3 top-3 text-white/30 text-xs"></i>
                <input type="text" placeholder="Search conversations..." 
                       class="w-full bg-[#0f1115] border border-white/10 rounded-lg pl-8 pr-3 py-2 text-xs text-white focus:border-purple-500 outline-none transition-all">
            </div>
            <div class="flex gap-2 mt-3 overflow-x-auto no-scrollbar">
                <button class="px-3 py-1 rounded-full bg-white/5 hover:bg-white/10 text-[10px] text-white/70 whitespace-nowrap border border-white/5">All</button>
                <button class="px-3 py-1 rounded-full bg-white/5 hover:bg-white/10 text-[10px] text-white/70 whitespace-nowrap border border-white/5">Unread</button>
                <button class="px-3 py-1 rounded-full bg-purple-500/10 hover:bg-purple-500/20 text-[10px] text-purple-400 whitespace-nowrap border border-purple-500/20">AI Active</button>
            </div>
        </div>

        <div id="crm-contact-list" class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1">
            </div>
    </div>

    <div id="crm-chat-window" class="hidden md:flex flex-1 flex-col bg-[#0f1115] relative">
        
        <div class="h-16 border-b border-white/5 flex justify-between items-center px-6 bg-[#111318]/50 backdrop-blur-sm">
            <div class="flex items-center gap-3">
                <button class="md:hidden text-white/60 mr-2 mobile-close-btn" onclick="crm.closeChat()">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <div class="relative">
                    <div id="chat-header-avatar" class="w-9 h-9 rounded-full bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center font-bold text-sm">?</div>
                    <div id="chat-header-indicator" class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-gray-500 border-2 border-[#0f1115] rounded-full"></div>
                </div>
                <div>
                    <h3 id="chat-header-name" class="font-medium text-sm text-white leading-tight cursor-pointer hover:underline decoration-white/30">Select a Chat</h3>
                    <p id="chat-header-status" class="text-[10px] text-white/40 font-mono mt-0.5">IDLE</p>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <div class="flex items-center gap-2 bg-white/5 px-2 py-1 rounded-lg border border-white/5">
                    <span class="text-[10px] text-white/50 uppercase tracking-wider font-bold">AI Agent</span>
                    <button id="ai-toggle-btn" onclick="crm.toggleAI()" class="w-8 h-4 bg-gray-600 rounded-full relative transition-colors">
                        <div class="w-3 h-3 bg-white rounded-full absolute top-0.5 left-0.5 transition-all shadow-sm"></div>
                    </button>
                </div>
                
                <button onclick="crm.resolveChat()" title="Mark Resolved" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-green-500/20 text-white/40 hover:text-green-400 transition-all">
                    <i class="fa-solid fa-check"></i>
                </button>
                <button onclick="crm.toggleContextSidebar()" title="Toggle Context" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/5 text-white/40 hover:text-white transition-all xl:hidden">
                    <i class="fa-solid fa-sidebar"></i>
                </button>
            </div>
        </div>

        <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar scroll-smooth">
            <div class="h-full flex flex-col items-center justify-center text-white/20">
                <i class="fa-brands fa-whatsapp text-4xl mb-3 opacity-20"></i>
                <p class="text-sm">Select a conversation to start messaging</p>
            </div>
        </div>

        <div class="p-4 bg-[#111318] border-t border-white/5">
            <div class="relative flex items-end gap-2 bg-[#0f1115] p-2 rounded-xl border border-white/10 focus-within:border-white/20 transition-colors">
                <div class="relative">
                    <div id="attach-menu" class="hidden absolute bottom-full mb-4 left-0 z-50 animate-in fade-in slide-in-from-bottom-2 duration-200">
                        <div class="bg-[#1a1d23] border border-[#2b2f3a] rounded-xl shadow-2xl p-2 flex flex-col gap-1 w-48">
                            <button onclick="openProductPicker('single')" class="flex items-center gap-3 px-3 py-2 hover:bg-white/5 rounded-lg text-left">
                                <i class="fa-solid fa-tag text-purple-400"></i>
                                <span class="text-sm text-white">Product</span>
                            </button>
                            <button onclick="openProductPicker('multi')" class="flex items-center gap-3 px-3 py-2 hover:bg-white/5 rounded-lg text-left">
                                <i class="fa-solid fa-layer-group text-blue-400"></i>
                                <span class="text-sm text-white">Collection</span>
                            </button>
                            <button onclick="triggerFileUpload('image')" class="flex items-center gap-3 px-3 py-2 hover:bg-white/5 rounded-lg text-left">
                                <i class="fa-solid fa-image text-green-400"></i>
                                <span class="text-sm text-white">Image</span>
                            </button>
                            <button onclick="triggerFileUpload('document')" class="flex items-center gap-3 px-3 py-2 hover:bg-white/5 rounded-lg text-left">
                                <i class="fa-solid fa-file-pdf text-orange-400"></i>
                                <span class="text-sm text-white">Document</span>
                            </button>
                        </div>
                    </div>

                    <button onclick="toggleAttachMenu()" class="w-10 h-10 rounded-full hover:bg-white/10 flex items-center justify-center text-white/60">
                        <i class="fa-solid fa-paperclip text-lg"></i>
                    </button>
                </div>

                <textarea id="message-input" rows="1" placeholder="Type a message..." 
                    class="w-full bg-transparent text-sm text-white focus:outline-none resize-none py-1.5 max-h-32 custom-scrollbar"></textarea>
                <button onclick="crm.sendMessage()" class="w-8 h-8 flex items-center justify-center bg-purple-600 hover:bg-purple-500 text-white rounded-lg shadow-lg shrink-0 transition-transform active:scale-95">
                    <i class="fa-solid fa-paper-plane text-xs"></i>
                </button>
            </div>
            <div id="ai-typing-indicator" class="hidden absolute bottom-20 left-6 flex items-center gap-2 bg-[#1a1d23] px-3 py-1.5 rounded-full border border-white/5 shadow-xl fade-in">
                <div class="flex gap-1">
                    <div class="w-1.5 h-1.5 bg-purple-500 rounded-full animate-bounce"></div>
                    <div class="w-1.5 h-1.5 bg-purple-500 rounded-full animate-bounce delay-75"></div>
                    <div class="w-1.5 h-1.5 bg-purple-500 rounded-full animate-bounce delay-150"></div>
                </div>
                <span class="text-[10px] text-white/50 font-medium">AI is replying...</span>
            </div>
        </div>
    </div>

    <input type="file" id="hidden-file-input" class="hidden" onchange="handleFileSelected(this)">

    <div id="right-sidebar" class="hidden xl:flex w-80 bg-[#111318] border-l border-white/10 flex-col transition-all duration-300 transform translate-x-0 overflow-y-auto">
        
        <div class="p-4 border-b border-white/5 sticky top-0 bg-[#111318] z-10">
            <h4 class="text-xs font-bold text-white/40 uppercase tracking-widest">Contact Info</h4>
        </div>

        <div id="right-sidebar-content" class="flex-1 overflow-y-auto p-4 space-y-6">
            
            <!-- Avatar & Contact Info Section -->
            <div class="flex flex-col items-center mb-6">
                <div id="sidebar-avatar" class="w-20 h-20 rounded-full bg-purple-600 flex items-center justify-center text-2xl font-bold mb-3 shadow-lg">
                </div>
                <h3 id="sidebar-name" class="text-xl font-semibold">Select a Contact</h3>
                <p id="sidebar-phone" class="text-white/50 text-sm font-mono mt-1">--</p>
                <span id="sidebar-platform" class="mt-2 px-2 py-0.5 rounded text-[10px] font-bold bg-white/10 text-white/60 uppercase tracking-wider hidden">
                    WHATSAPP
                </span>
            </div>

            <!-- Active Interest Card -->
            <div class="mb-6">
                <div class="flex items-center justify-between mb-2">
                    <h4 class="text-xs font-bold text-white/40 uppercase tracking-wider">Active Interest</h4>
                    <button id="btn-create-deal" class="text-xs text-purple-400 hover:text-purple-300">
                        <i class="fa-solid fa-plus"></i> Deal
                    </button>
                </div>
                <div id="sidebar-cart-container" class="bg-[#1a1d23] rounded-xl p-4 border border-[#2b2f3a] min-h-[80px]">
                    <p class="text-white/20 text-xs text-center italic mt-2">No active items or deals.</p>
                </div>
            </div>

            <!-- AI Memory & Notes Section -->
            <div class="mb-6">
                <div class="flex items-center justify-between mb-2">
                    <h4 class="text-xs font-bold text-white/40 uppercase tracking-wider">AI Memory & Notes</h4>
                    <span class="text-[10px] text-green-500/60"><i class="fa-solid fa-brain"></i> Auto-updating</span>
                </div>
                <textarea id="sidebar-notes" 
                    class="w-full bg-[#1a1d23] border border-[#2b2f3a] rounded-xl p-3 text-sm text-white/80 focus:border-purple-500 outline-none resize-none h-32 transition-colors"
                    placeholder="AI will generate notes here based on the conversation..."></textarea>
                <div class="flex justify-end mt-2">
                     <button onclick="saveContactNotes()" class="text-xs bg-white/5 hover:bg-white/10 px-3 py-1 rounded text-white/60">Save Notes</button>
                </div>
            </div>

            <!-- Tags Section -->
            <div class="mb-6">
                <h4 class="text-xs font-bold text-white/40 uppercase tracking-wider mb-2">Tags</h4>
                <div id="sidebar-tags" class="flex flex-wrap gap-2">
                </div>
            </div>

        </div>
    </div>
</div>

        <!-- Facebook Section -->
        <div id="view-facebook" class="view-section hidden h-full flex gap-4 lg:gap-6 relative fade-in">
            <div class="w-full md:w-80 lg:w-96 bg-[#1a1d23] border border-[#2b2f3a] rounded-2xl flex flex-col h-full shadow-xl overflow-hidden relative">
                <div id="fb-conversation-list" class="flex-1 overflow-y-auto"></div>
                <div id="fb-empty-state" class="hidden absolute inset-0 flex flex-col items-center justify-center p-4 text-center bg-[#1a1d23] rounded-2xl">
                    <i class="fa-brands fa-facebook text-6xl text-blue-600 mb-4 opacity-40"></i>
                    <p class="text-white/50 text-sm">Your conversations appear here</p>
                </div>
            </div>

            <div id="facebook-chat-window" class="mobile-chat-overlay hidden md:flex flex-1 bg-[#1a1d23] border border-[#2b2f3a] rounded-2xl flex-col h-full relative overflow-hidden shadow-xl md:rounded-2xl md:border">
                <div class="p-3 border-b border-[#2b2f3a] flex justify-between items-center bg-[#202c33] z-10">
                    <div class="flex items-center gap-3 flex-1">
                        <button onclick="crm.closeMobileChat()" class="mobile-close-btn text-white/70 mr-2"><i class="fa-solid fa-arrow-left"></i></button>
                        <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold relative">
                            <span id="facebook-chat-header-avatar">?</span>
                        </div>
                        <div>
                            <div class="font-bold text-sm cursor-pointer" id="facebook-chat-header-name" title="View contact">Select a conversation</div>
                            <div class="flex items-center gap-2">
                                <div id="facebook-chat-header-indicator" class="w-2 h-2 rounded-full bg-gray-500"></div>
                                <div class="text-xs text-white/50" id="facebook-chat-header-status">...</div>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div id="fb-ai-indicator" class="hidden mr-2 text-xs text-white/60"><i class="fa-solid fa-robot mr-1"></i> AI</div>
                        <button id="facebook-contact-notes-btn" onclick="crm.openContactModal()" class="px-3 py-1 bg-white/5 hover:bg-white/10 text-xs rounded-md border border-white/10 flex items-center gap-2">
                            <i class="fa-regular fa-note-sticky"></i>
                            Notes
                        </button>
                    </div>
                </div>

                <div id="fb-messages-area" class="flex-1 overflow-y-auto p-4 space-y-3 bg-[#0b141a] chat-bg relative">
                    <div class="flex h-full items-center justify-center text-white/30 text-sm flex-col">
                        <i class="fa-brands fa-facebook text-4xl mb-3 opacity-50"></i>
                        <p>Select a conversation</p>
                    </div>
                </div>

                <div id="facebook-chat-input-container" class="p-3 bg-[#202c33] flex gap-2 items-center hidden">
                    <input type="file" id="facebook-chat-file-upload" class="hidden" onchange="alert('File uploaded (Mock)')">
                    <button onclick="toggleAttachMenu()" class="text-white/50 hover:text-white p-2"><i class="fa-solid fa-paperclip"></i></button>
                    <input type="text" id="facebook-chat-input" placeholder="Type a message..." class="flex-1 bg-[#2a3942] rounded-lg px-4 py-3 text-sm text-white focus:outline-none" onkeypress="if(event.key === 'Enter') crm.sendMessage()">
                    <button onclick="crm.sendMessage()" class="p-3 bg-[#005c4b] hover:bg-[#005c4b]/80 rounded-full text-white w-10 h-10 flex items-center justify-center shadow-lg"><i class="fa-solid fa-paper-plane text-sm"></i></button>
                </div>
                
                <div id="facebook-chat-input-disabled" class="p-4 bg-[#202c33] text-center text-xs text-white/40 border-t border-[#2b2f3a] hidden">
                    <i class="fa-solid fa-robot mr-2"></i> AI Auto-Pilot is active. Turn off to type manually.
                </div>
            </div>
        </div>

        <!-- Instagram Section -->
        <div id="view-instagram" class="view-section hidden h-full flex gap-4 lg:gap-6 relative fade-in">
            <div class="w-full md:w-80 lg:w-96 bg-[#1a1d23] border border-[#2b2f3a] rounded-2xl flex flex-col h-full shadow-xl overflow-hidden relative">
                <div id="ig-conversation-list" class="flex-1 overflow-y-auto"></div>
                <div id="ig-empty-state" class="hidden absolute inset-0 flex flex-col items-center justify-center p-4 text-center bg-[#1a1d23] rounded-2xl">
                    <i class="fa-brands fa-instagram text-6xl text-pink-500 mb-4 opacity-40"></i>
                    <p class="text-white/50 text-sm">Your conversations appear here</p>
                </div>
            </div>

            <div id="instagram-chat-window" class="mobile-chat-overlay hidden md:flex flex-1 bg-[#1a1d23] border border-[#2b2f3a] rounded-2xl flex-col h-full relative overflow-hidden shadow-xl md:rounded-2xl md:border">
                <div class="p-3 border-b border-[#2b2f3a] flex justify-between items-center bg-[#202c33] z-10">
                    <div class="flex items-center gap-3 flex-1">
                        <button onclick="crm.closeMobileChat()" class="mobile-close-btn text-white/70 mr-2"><i class="fa-solid fa-arrow-left"></i></button>
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-600 to-pink-600 flex items-center justify-center text-white font-bold relative">
                            <span id="instagram-chat-header-avatar">?</span>
                        </div>
                        <div>
                            <div class="font-bold text-sm cursor-pointer" id="instagram-chat-header-name" title="View contact">Select a conversation</div>
                            <div class="flex items-center gap-2">
                                <div id="instagram-chat-header-indicator" class="w-2 h-2 rounded-full bg-gray-500"></div>
                                <div class="text-xs text-white/50" id="instagram-chat-header-status">...</div>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div id="ig-ai-indicator" class="hidden mr-2 text-xs text-white/60"><i class="fa-solid fa-robot mr-1"></i> AI</div>
                        <button id="instagram-contact-notes-btn" onclick="crm.openContactModal()" class="px-3 py-1 bg-white/5 hover:bg-white/10 text-xs rounded-md border border-white/10 flex items-center gap-2">
                            <i class="fa-regular fa-note-sticky"></i>
                            Notes
                        </button>
                    </div>
                </div>

                <div id="ig-messages-area" class="flex-1 overflow-y-auto p-4 space-y-3 bg-[#0b141a] chat-bg relative">
                    <div class="flex h-full items-center justify-center text-white/30 text-sm flex-col">
                        <i class="fa-brands fa-instagram text-4xl mb-3 opacity-50"></i>
                        <p>Select a conversation</p>
                    </div>
                </div>

                <div id="instagram-chat-input-container" class="p-3 bg-[#202c33] flex gap-2 items-center hidden">
                    <input type="file" id="instagram-chat-file-upload" class="hidden" onchange="alert('File uploaded (Mock)')">
                    <button onclick="toggleAttachMenu()" class="text-white/50 hover:text-white p-2"><i class="fa-solid fa-paperclip"></i></button>
                    <input type="text" id="instagram-chat-input" placeholder="Type a message..." class="flex-1 bg-[#2a3942] rounded-lg px-4 py-3 text-sm text-white focus:outline-none" onkeypress="if(event.key === 'Enter') crm.sendMessage()">
                    <button onclick="crm.sendMessage()" class="p-3 bg-[#005c4b] hover:bg-[#005c4b]/80 rounded-full text-white w-10 h-10 flex items-center justify-center shadow-lg"><i class="fa-solid fa-paper-plane text-sm"></i></button>
                </div>
                
                <div id="instagram-chat-input-disabled" class="p-4 bg-[#202c33] text-center text-xs text-white/40 border-t border-[#2b2f3a] hidden">
                    <i class="fa-solid fa-robot mr-2"></i> AI Auto-Pilot is active. Turn off to type manually.
                </div>
            </div>
        </div>

        <!-- TikTok Section -->
        <div id="view-tiktok" class="view-section hidden h-full flex gap-4 lg:gap-6 relative fade-in">
            <div class="w-full md:w-80 lg:w-96 bg-[#1a1d23] border border-[#2b2f3a] rounded-2xl flex flex-col h-full shadow-xl overflow-hidden relative">
                <div id="tt-conversation-list" class="flex-1 overflow-y-auto"></div>
                <div id="tt-empty-state" class="hidden absolute inset-0 flex flex-col items-center justify-center p-4 text-center bg-[#1a1d23] rounded-2xl">
                    <i class="fa-brands fa-tiktok text-6xl text-white mb-4 opacity-40"></i>
                    <p class="text-white/50 text-sm">Your conversations appear here</p>
                </div>
            </div>

            <div id="tiktok-chat-window" class="mobile-chat-overlay hidden md:flex flex-1 bg-[#1a1d23] border border-[#2b2f3a] rounded-2xl flex-col h-full relative overflow-hidden shadow-xl md:rounded-2xl md:border">
                <div class="p-3 border-b border-[#2b2f3a] flex justify-between items-center bg-[#202c33] z-10">
                    <div class="flex items-center gap-3 flex-1">
                        <button onclick="crm.closeMobileChat()" class="mobile-close-btn text-white/70 mr-2"><i class="fa-solid fa-arrow-left"></i></button>
                        <div class="w-10 h-10 rounded-full bg-cyan-600 flex items-center justify-center text-white font-bold relative">
                            <span id="tiktok-chat-header-avatar">?</span>
                        </div>
                        <div>
                            <div class="font-bold text-sm cursor-pointer" id="tiktok-chat-header-name" title="View contact">Select a conversation</div>
                            <div class="flex items-center gap-2">
                                <div id="tiktok-chat-header-indicator" class="w-2 h-2 rounded-full bg-gray-500"></div>
                                <div class="text-xs text-white/50" id="tiktok-chat-header-status">...</div>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div id="tt-ai-indicator" class="hidden mr-2 text-xs text-white/60"><i class="fa-solid fa-robot mr-1"></i> AI</div>
                        <button id="tiktok-contact-notes-btn" onclick="crm.openContactModal()" class="px-3 py-1 bg-white/5 hover:bg-white/10 text-xs rounded-md border border-white/10 flex items-center gap-2">
                            <i class="fa-regular fa-note-sticky"></i>
                            Notes
                        </button>
                    </div>
                </div>

                <div id="tt-messages-area" class="flex-1 overflow-y-auto p-4 space-y-3 bg-[#0b141a] chat-bg relative">
                    <div class="flex h-full items-center justify-center text-white/30 text-sm flex-col">
                        <i class="fa-brands fa-tiktok text-4xl mb-3 opacity-50"></i>
                        <p>Select a conversation</p>
                    </div>
                </div>

                <div id="tiktok-chat-input-container" class="p-3 bg-[#202c33] flex gap-2 items-center hidden">
                    <input type="file" id="tiktok-chat-file-upload" class="hidden" onchange="alert('File uploaded (Mock)')">
                    <button onclick="toggleAttachMenu()" class="text-white/50 hover:text-white p-2"><i class="fa-solid fa-paperclip"></i></button>
                    <input type="text" id="tiktok-chat-input" placeholder="Type a message..." class="flex-1 bg-[#2a3942] rounded-lg px-4 py-3 text-sm text-white focus:outline-none" onkeypress="if(event.key === 'Enter') crm.sendMessage()">
                    <button onclick="crm.sendMessage()" class="p-3 bg-[#005c4b] hover:bg-[#005c4b]/80 rounded-full text-white w-10 h-10 flex items-center justify-center shadow-lg"><i class="fa-solid fa-paper-plane text-sm"></i></button>
                </div>
                
                <div id="tiktok-chat-input-disabled" class="p-4 bg-[#202c33] text-center text-xs text-white/40 border-t border-[#2b2f3a] hidden">
                    <i class="fa-solid fa-robot mr-2"></i> AI Auto-Pilot is active. Turn off to type manually.
                </div>
            </div>
        </div>

        <div id="view-ai-playground" class="view-section hidden-force h-full flex flex-col md:flex-row gap-6 p-4 md:p-6 overflow-hidden animate-fade-in">
    
    <div class="flex-1 flex flex-col min-h-0 bg-[#1a1d23] rounded-2xl border border-[#2b2f3a] overflow-hidden shadow-2xl">
        
        <div class="p-5 border-b border-[#2b2f3a] bg-[#232730] flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
            <div>
                <h2 class="text-lg font-bold text-white flex items-center gap-2">
                    <i class="fa-solid fa-wand-magic-sparkles text-purple-400"></i> My AI Instructions
                </h2>
                <p class="text-xs text-white/40 mt-1">Edit instructions here to test. Submit changes to admin for approval.</p>
            </div>
            
            <div class="flex gap-2">
                <button onclick="aiManager.loadMyBusinessPrompt()" class="px-3 py-2 bg-[#2b2f3a] hover:bg-[#32363f] border border-[#3f4552] rounded-lg text-xs font-bold text-white/70 transition-all flex items-center gap-2" title="Reset to Live Version">
                    <i class="fa-solid fa-rotate-left"></i> Reset
                </button>
                <button onclick="aiPlayground.submitSuggestion()" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 rounded-lg text-xs font-bold text-white shadow-lg transition-all flex items-center gap-2">
                    <i class="fa-solid fa-paper-plane"></i> Submit to Admin
                </button>
            </div>
        </div>

        <div class="px-5 py-3 border-b border-[#2b2f3a] bg-[#1a1d23] flex flex-wrap gap-3 items-center">
            <span class="text-[10px] font-bold uppercase text-white/30 tracking-wider">Platform:</span>
            
            <div class="flex gap-3">
                <button id="btn-sim-whatsapp" onclick="aiPlayground.selectPlatform('whatsapp')" class="sim-platform-btn text-green-500 text-xl transition-all hover:scale-110 bg-[#2b2f3a] rounded-lg p-2" title="WhatsApp">
                    <i class="fa-brands fa-whatsapp"></i>
                </button>
                <button id="btn-sim-instagram" onclick="aiPlayground.selectPlatform('instagram')" class="sim-platform-btn text-white/40 text-xl transition-all hover:scale-110" title="Instagram">
                    <i class="fa-brands fa-instagram"></i>
                </button>
                <button id="btn-sim-facebook" onclick="aiPlayground.selectPlatform('facebook')" class="sim-platform-btn text-white/40 text-xl transition-all hover:scale-110" title="Facebook">
                    <i class="fa-brands fa-facebook"></i>
                </button>
                <button id="btn-sim-tiktok" onclick="aiPlayground.selectPlatform('tiktok')" class="sim-platform-btn text-white/40 text-xl transition-all hover:scale-110" title="TikTok">
                    <i class="fa-brands fa-tiktok"></i>
                </button>
            </div>
        </div>

        <textarea id="business-system-prompt" class="flex-1 bg-[#0f1115] p-5 text-white/90 font-mono text-sm leading-relaxed focus:outline-none resize-none m-0 border-none placeholder-white/20" placeholder="Describe your business, products, prices, and tone here..."></textarea>
    </div>

    <div class="w-full md:w-[400px] flex flex-col min-h-0 bg-[#1a1d23] rounded-2xl border border-[#2b2f3a] overflow-hidden shadow-2xl relative">
        
        <div class="p-4 bg-[#232730] border-b border-[#2b2f3a] flex justify-between items-center z-10 shadow-sm">
            <div>
                <div class="font-bold text-sm text-green-400 flex items-center gap-2">
                    <span class="relative flex h-2 w-2">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                    </span>
                    <span id="sim-platform-label">WhatsApp</span>
                </div>
            </div>
            <button onclick="aiPlayground.clearChat()" class="text-xs text-white/30 hover:text-white transition-colors"><i class="fa-solid fa-trash"></i> Clear</button>
        </div>

        <div id="playground-chat-feed" class="flex-1 overflow-y-auto p-4 space-y-3 bg-[#0f1115] relative bg-opacity-5 bg-repeat" data-platform="whatsapp" style="background-image: linear-gradient(rgba(15, 17, 21, 0.9), rgba(15, 17, 21, 0.9)), url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');">
            <div class="text-center mt-12 opacity-40">
                <div class="w-16 h-16 bg-[#1a1d23] rounded-full flex items-center justify-center mx-auto mb-3 border border-[#2b2f3a]">
                    <i class="fa-solid fa-robot text-2xl text-purple-500"></i>
                </div>
                <p class="text-xs font-medium">Test your instructions here.<br>No messages will be sent to customers.</p>
            </div>
        </div>

        <div class="p-3 bg-[#232730] border-t border-[#2b2f3a]">
            
            <div class="flex items-center justify-between mb-2 px-1">
                <label class="flex items-center cursor-pointer gap-2 group" title="If checked, uses the text from the editor on the left. If unchecked, uses the currently saved live version.">
                    <div class="relative inline-flex items-center">
                        <input type="checkbox" id="pg-use-unsaved" class="sr-only peer" checked> <div class="w-8 h-4 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-purple-600 transition-colors"></div>
                    </div>
                    <span class="text-[10px] font-bold text-white/50 group-hover:text-white/80 transition-colors uppercase tracking-wide">Test Draft Edits</span>
                </label>
            </div>

            <div class="flex gap-2 relative">
                <textarea id="pg-input" rows="1" class="flex-1 bg-[#1a1d23] border border-[#2b2f3a] rounded-xl px-4 py-3 text-sm text-white focus:border-purple-500 focus:outline-none resize-none shadow-inner placeholder-white/30" placeholder="Type a message..." onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); aiPlayground.send(); }"></textarea>
                <button id="pg-send-btn" onclick="aiPlayground.send()" class="w-12 h-11 rounded-xl bg-gradient-to-br from-green-600 to-green-600 hover:from-green-500 hover:to-green-500 text-white flex items-center justify-center transition-all shadow-lg active:scale-95">
                    <i class="fa-solid fa-paper-plane text-sm"></i>
                </button>
            </div>
        </div>
    </div>
</div>
        <!-- Facebook Comments Section -->
        <div id="view-facebook-comments" class="view-section hidden h-full fade-in">
            <p class="text-white/30">Facebook Comments section</p>
        </div>

        <!-- Instagram Comments Section -->
        <div id="view-instagram-comments" class="view-section hidden h-full fade-in">
            <p class="text-white/30">Instagram Comments section</p>
        </div>

        <!-- TikTok Comments Section -->
        <div id="view-tiktok-comments" class="view-section hidden h-full fade-in">
            <p class="text-white/30">TikTok Comments section</p>
        </div>

        <div id="view-placeholder" class="view-section hidden h-full flex flex-col items-center justify-center text-white/30 fade-in">
            <i class="fa-solid fa-layer-group text-6xl mb-4"></i>
            <h3 class="text-xl font-semibold mb-2">Section Under Construction</h3>
            <p>This module is not yet connected to the backend.</p>
        </div>

        <div id="view-lists" class="view-section hidden h-full fade-in">
            </div>

    </div>

    <!-- Contact Modal (shared with admin) -->
    <div id="contact-modal" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/80 backdrop-blur-sm hidden-force">
        <div class="w-full max-w-md bg-[#1a1d23] rounded-2xl border border-[#2b2f3a] shadow-2xl overflow-hidden">
            <div class="p-5 border-b border-[#2b2f3a] flex justify-between items-center bg-[#232730]">
                <h3 class="font-bold text-lg">Contact Details</h3>
                <button onclick="document.getElementById('contact-modal').classList.add('hidden-force')" class="text-white/50 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center text-white font-bold" id="contact-modal-avatar">?</div>
                    <div class="flex-1">
                        <input id="contact-modal-name-input" type="text" placeholder="Name (e.g. ManyChats User)" class="w-full bg-transparent border-b border-white/10 pb-1 text-white focus:outline-none" />
                        <input id="contact-modal-phone-input" type="text" placeholder="Phone (optional)" class="w-full bg-transparent text-xs text-white/60 mt-1 focus:outline-none" />
                    </div>
                </div>

                <input type="hidden" id="contact-modal-id">
                <label class="text-xs text-white/50">Notes (updates contact notes directly)</label>
                <textarea id="contact-modal-notes" rows="6" class="w-full bg-[#0f1115] border border-[#2b2f3a] rounded-lg p-3 text-white focus:border-purple-500 outline-none resize-none" placeholder="Private contact notes..."></textarea>

                <div class="flex justify-end gap-3">
                    <button type="button" onclick="document.getElementById('contact-modal').classList.add('hidden-force')" class="px-4 py-2 text-white/60 hover:text-white text-sm">Close</button>
                    <button id="contact-modal-save" type="button" class="px-6 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg font-medium text-sm">Save</button>
                </div>
            </div>
        </div>
    </div>
    

<div id="product-picker-modal" class="hidden fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
    <div class="bg-[#1a1d23] w-full max-w-lg rounded-2xl border border-[#2b2f3a] shadow-2xl flex flex-col max-h-[80vh]">
        
        <div class="p-4 border-b border-white/5 flex justify-between items-center">
            <h3 id="picker-title" class="font-semibold text-white">Select Product</h3>
            <button onclick="closeProductPicker()" class="text-white/40 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
        </div>

        <div class="p-4 pb-0">
            <div class="relative">
                <i class="fa-solid fa-search absolute left-3 top-3 text-white/30 text-xs"></i>
                <input type="text" id="picker-search" onkeyup="searchPickerProducts()" placeholder="Type to search inventory..." 
                    class="w-full bg-[#0f1115] border border-[#2b2f3a] rounded-lg py-2 pl-9 pr-3 text-sm text-white focus:border-purple-500 outline-none">
            </div>
        </div>

        <div id="picker-list" class="flex-1 overflow-y-auto p-4 space-y-2">
            <div class="text-center text-white/20 py-8 text-xs">Loading inventory...</div>
        </div>

        <div class="p-3 border-t border-white/5 bg-[#14161a] flex items-center justify-center gap-3">
            <button id="picker-show-more" onclick="loadMoreProducts()" class="px-4 py-2 bg-white/5 hover:bg-white/10 text-sm rounded-lg text-white/70 hidden">Show more</button>
            <div id="picker-loading-indicator" class="text-xs text-white/40 hidden">Loading...</div>
        </div>

        <div class="p-4 border-t border-white/5 flex justify-between items-center bg-[#14161a] rounded-b-2xl">
            <span id="picker-count" class="text-xs text-white/40">0 selected</span>
            <button id="picker-send-btn" onclick="sendProductSelection()" class="bg-purple-600 hover:bg-purple-500 text-white text-sm font-medium px-6 py-2 rounded-lg transition-colors">
                Send
            </button>
        </div>
    </div>
</div>

</body>
</html>