<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Loading Product...</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        tailwind.config = {
            darkMode: ['class', '[data-theme="dark"]'],
            theme: {
                extend: {
                    colors: {
                        page: 'var(--bg-page)',
                        card: 'var(--card-bg)',
                        main: 'var(--text-main)',
                        muted: 'var(--text-muted)',
                        border: 'var(--border-color)',
                        input: 'var(--input-bg)'
                    }
                }
            }
        }
    </script>

    <style>
        /* --- Dynamic Theme Variables --- */
        :root {
            /* Light Theme (Default) */
            --bg-page: #f9fafb; /* Soft gray-white */
            --card-bg: #ffffff; /* Pure white cards */
            --text-main: #111827; /* Deep slate text */
            --text-muted: #6b7280;
            --border-color: #e5e7eb;
            --input-bg: #f3f4f6;
            
            --primary-color: #7c3aed; 
            --secondary-color: #ea580c; 
        }

        [data-theme="dark"] {
            /* Dark Theme */
            --bg-page: #0f1115;
            --card-bg: #1a1d23;
            --text-main: #ffffff;
            --text-muted: #9ca3af;
            --border-color: rgba(255,255,255,0.1);
            --input-bg: #252830;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-page);
            color: var(--text-main);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Utility */
        .btn-primary { background-color: var(--primary-color); color: white; }
        .text-primary { color: var(--primary-color); }
        .text-secondary { color: var(--secondary-color); }
        .border-primary { border-color: var(--primary-color); }
        
        /* Inputs & Cards */
        .theme-card { background-color: var(--card-bg); border: 1px solid var(--border-color); }
        .theme-input { background-color: var(--input-bg); color: var(--text-main); border: 1px solid var(--border-color); }
        .theme-input:focus { border-color: var(--primary-color); outline: none; }

        /* Gallery & UI */
        .gallery-thumb.active { border-color: var(--primary-color); opacity: 1; }
        .var-btn { background-color: var(--card-bg); color: var(--text-main); border: 1px solid var(--border-color); }
        .var-btn:hover { border-color: var(--primary-color); }
        .var-btn.selected { background-color: var(--primary-color); border-color: var(--primary-color); color: white; }
        
        .loader { border: 3px solid var(--text-muted); border-top: 3px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Pricing Styles */
        .old-price { text-decoration: line-through; color: var(--secondary-color); font-size: 0.9em; margin-right: 8px; opacity: 0.8; }
        .flash-badge { background-color: var(--secondary-color); color: white; }
        
        /* Mobile Sticky Button */
        .mobile-sticky-btn {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--card-bg); 
            border-top: 1px solid var(--border-color); padding: 16px; z-index: 40; display: block;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        @media (min-width: 768px) { .mobile-sticky-btn { display: none; } }

        @media (max-width: 767px) {
            #purchase-panel .availability-row { display: none; }
            #purchase-panel .inblock-whatsapp { display: none !important; }
            header { padding-left: 1rem; padding-right: 1rem; }
            #main-content { padding-bottom: 140px; }
        }

        /* Announcement Bar */
        #announcement-bar {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white; text-align: center; padding: 8px; font-size: 0.85rem; font-weight: 600;
            display: none;
        }

        /* Desktop Adjustments */
        @media (min-width: 768px) {
            #purchase-panel { align-self: flex-start; margin-top: 1rem; }
            #purchase-panel > div { display: flex; }
            #purchase-panel .inblock-whatsapp { flex: none !important; display: block !important; width: 100% !important; }
        }

        /* Modal Transitions */
        .modal-backdrop {
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .modal-backdrop.open { opacity: 1; pointer-events: auto; }
        .modal-content { transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-backdrop.open .modal-content { transform: scale(1); }

        /* Force WhatsApp CTA text to remain white in light theme */
        [data-theme="light"] .inblock-whatsapp,
        [data-theme="light"] .mobile-sticky-btn button {
            color: white !important;
        }
        .inblock-whatsapp, .mobile-sticky-btn button {
            color: white !important;
        }
    </style>
    <script>(function(){try{var t=null;try{t=localStorage.getItem('vvTheme')}catch(e){} if(!t) t='light'; if(t==='light') document.documentElement.setAttribute('data-theme','light'); else document.documentElement.removeAttribute('data-theme');}catch(e){} })();</script>
    <link rel="stylesheet" href="theme.css">
    <script src="theme-toggle.js" defer></script>
</head>
<body>

    <div class="fixed top-4 right-4 z-50">
        <button onclick="toggleTheme()" class="w-8 h-8 rounded-full theme-card shadow-lg flex items-center justify-center text-main hover:text-primary transition-colors">
            <i id="theme-icon" class="fa-solid fa-moon text-sm"></i>
        </button>
    </div>

    <div id="announcement-bar">
        <i class="fa-solid fa-truck-fast mr-2"></i> <span id="announcement-text"></span>
    </div>

    <div id="loading-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-page">
        <div class="loader mb-4"></div>
        <p class="text-muted animate-pulse">Loading Product Details...</p>
    </div>

    <div class="mobile-sticky-btn">
        <button onclick="openOrderModal()" class="w-full bg-[#25D366] text-white font-bold py-3.5 rounded-xl flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-transform">
            <i class="fa-brands fa-whatsapp text-xl"></i>
            <span id="mobile-cta-text">Order on WhatsApp</span>
        </button>
    </div>

    <div id="error-screen" class="hidden fixed inset-0 z-50 flex flex-col items-center justify-center bg-page p-6 text-center">
        <div class="text-4xl mb-4">ðŸ˜•</div>
        <h2 class="text-xl font-bold mb-2 text-main">Product Not Found</h2>
        <p class="text-muted max-w-md">The product link might be incorrect or expired.</p>
    </div>

    <div id="main-content" class="hidden max-w-7xl mx-auto px-4 py-6 lg:py-12">
        
        <header class="w-full max-w-6xl px-4 py-4 flex items-center justify-center relative mb-2">
            <div class="flex items-center gap-3">
                <img id="biz-logo" src="" alt="Logo" class="h-10 w-auto object-contain hidden"> 
                <div id="logo-placeholder" class="h-10 w-10 theme-card rounded-full flex items-center justify-center shadow-sm">
                    <i class="fa-solid fa-store text-muted"></i>
                </div>
                <h1 id="biz-name" class="font-brand font-semibold text-lg text-main uppercase tracking-widest">Store</h1>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16">
            
            <div class="space-y-4">
                <div class="aspect-square w-full rounded-2xl overflow-hidden bg-gray-100 relative group theme-card shadow-sm">
                    <img id="main-image" src="" alt="Product Image" class="w-full h-full object-cover">
                    
                    <div id="offer-badge" class="hidden absolute top-4 left-4 flash-badge text-xs font-bold px-3 py-1 rounded-full shadow-lg z-10">
                        SALE
                    </div>
                </div>
                <div id="image-thumbnails" class="flex space-x-3 overflow-x-auto pb-2"></div>
            </div>

            <div class="flex flex-col">
                <div class="mb-6">
                    <h1 id="product-title" class="text-3xl md:text-4xl font-bold mb-3 text-main">...</h1>
                    
                    <div class="flex items-center flex-wrap gap-3 text-2xl">
                        <span id="price-old" class="hidden old-price"></span>
                        <span id="price-current" class="font-bold text-primary">...</span>
                    </div>

                    <div id="offer-timer" class="hidden mt-3 p-2 theme-card border border-primary/20 rounded-lg inline-flex items-center gap-3 shadow-sm">
                    </div>
                </div>

                <div class="prose mb-6">
                    <p id="product-desc-short" class="text-lg text-muted leading-relaxed">...</p>
                </div>

                <div id="bundle-container" class="hidden mb-6 bg-gradient-to-r from-gray-50 to-gray-100 border border-secondary rounded-xl p-4 relative overflow-hidden shadow-sm">
                    <div class="absolute top-0 right-0 bg-secondary text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg">
                        SPECIAL OFFER
                    </div>
                    <div class="flex items-center gap-4">
                        <img id="bundle-img" src="" class="w-16 h-16 rounded-lg object-cover bg-white shadow-sm">
                        <div>
                            <p id="bundle-label" class="text-sm font-bold text-secondary mb-0.5">FREE GIFT INCLUDED</p>
                            <p id="bundle-title" class="text-gray-900 font-medium text-sm">...</p>
                            <p class="text-xs text-gray-500 mt-1">When you order this item today.</p>
                        </div>
                    </div>
                </div>

                <div id="variations-container" class="space-y-6 mb-8"></div>

                <div id="purchase-panel" class="theme-card p-6 rounded-2xl shadow-sm">
                    <div class="flex items-center justify-between mb-4 availability-row">
                        <span class="text-sm text-muted">Availability</span>
                        <span id="stock-status" class="font-medium text-green-500">Checking...</span>
                    </div>

                    <div class="flex gap-4">
                        <button id="btn-whatsapp" onclick="openOrderModal()" class="inblock-whatsapp flex-1 bg-[#25D366] hover:opacity-90 text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center space-x-2 transition-all shadow-md">
                            <i class="fa-brands fa-whatsapp text-xl"></i>
                            <span id="desktop-cta-text">Order on WhatsApp</span>
                        </button>
                    </div>
                </div>

                <div id="key-functions" class="mb-6 theme-card p-4 rounded-2xl text-sm text-muted">
                    <div class="font-semibold text-main mb-2">Key Functions</div>
                    <div id="key-features-inline" class="text-muted"></div>
                </div>

                <div class="mt-8 theme-card rounded-2xl overflow-hidden shadow-sm">
                    <div class="px-6 py-4">
                        <div class="font-semibold text-main mb-3">Full Details</div>
                        <div id="product-desc-long" class="text-muted text-sm leading-relaxed"></div>
                        <button id="show-more-btn" class="hidden mt-2 text-primary font-medium text-sm hover:underline">Show More</button>
                    </div>
                </div>
            </div>
        </div>

        <section class="mt-12 mb-12 theme-card rounded-2xl p-6 shadow-sm">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-main">Customer Reviews</h2>
                <div class="text-orange-500 flex items-center gap-1">
                    <i class="fa-solid fa-star"></i>
                    <span class="font-bold text-main" id="avg-rating">0.0</span>
                </div>
            </div>
            <div id="reviews-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <div class="flex justify-center mt-6 mb-16">
            <button id="help-btn" onclick="openDiscountModal()" class="px-6 py-3 rounded-xl border border-border text-muted hover:text-primary hover:border-primary hover:bg-page transition-all text-sm font-medium flex items-center gap-2">
                <i class="fa-regular fa-circle-question"></i>
                Unable to Place Order Now? Click Here
            </button>
        </div>
    </div>

    <div id="modal-order" class="modal-backdrop fixed inset-0 z-[60] flex items-center justify-center px-4 bg-black/60 backdrop-blur-sm">
        <div class="modal-content w-full max-w-md theme-card rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-4 border-b border-border flex justify-between items-center bg-page">
                <h3 class="font-bold text-main">Confirm Order Details</h3>
                <button onclick="closeModals()" class="text-muted hover:text-red-500 transition-colors"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
            <div class="p-6 overflow-y-auto">
                <div class="flex gap-4 mb-6 bg-page p-3 rounded-xl border border-border">
                    <img id="modal-img" src="" class="w-16 h-16 object-cover rounded-lg bg-gray-200">
                    <div>
                        <p id="modal-title" class="font-bold text-sm text-main line-clamp-1">Product Name</p>
                        <p id="modal-variant" class="text-xs text-muted mb-1">Standard</p>
                        <p id="modal-price" class="font-bold text-primary">KES 0</p>
                    </div>
                </div>

                <form id="order-form" onsubmit="handleOrderSubmit(event)" class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-muted uppercase mb-1">Shipping Address / Location</label>
                        <textarea id="inp-address" required rows="2" class="w-full theme-input rounded-xl p-3 text-sm" placeholder="e.g. CBD, Nairobi, Near Tuskys..."></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-muted uppercase mb-1">WhatsApp Number</label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-muted"><i class="fa-brands fa-whatsapp"></i></span>
                            <input id="inp-phone" type="tel" required class="w-full theme-input rounded-xl pl-10 p-3 text-sm" placeholder="07XX XXX XXX">
                        </div>
                    </div>
                    
                    <div class="pt-2">
                        <button type="submit" id="btn-confirm-order" class="w-full bg-[#25D366] hover:bg-[#20bd5a] text-white font-bold py-3.5 rounded-xl shadow-lg flex items-center justify-center gap-2 transition-all">
                            <span>Confirm & Order</span>
                            <i class="fa-solid fa-paper-plane"></i>
                        </button>
                        <p class="text-[10px] text-center text-muted mt-3">
                            Clicking confirm generates an Order ID and opens WhatsApp.
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="modal-discount" class="modal-backdrop fixed inset-0 z-[60] flex items-center justify-center px-4 bg-black/60 backdrop-blur-sm">
        <div class="modal-content w-full max-w-sm theme-card rounded-2xl shadow-2xl overflow-hidden p-6 text-center">
            <div class="w-16 h-16 bg-primary/10 text-primary rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                <i class="fa-solid fa-gift"></i>
            </div>
            
            <h3 class="text-xl font-bold text-main mb-2">That's Understandable!</h3>
            <p class="text-muted text-sm mb-6 leading-relaxed">
                Not ready to buy today? No problem. <br>
                <span class="text-secondary font-bold">Our next Flash Sale is 30% OFF!</span><br>
                Leave your WhatsApp number to get alerted.
            </p>

            <form id="discount-form" onsubmit="handleDiscountSubmit(event)" class="space-y-4">
                <input id="inp-lead-phone" type="tel" required class="w-full theme-input rounded-xl p-3 text-sm text-center" placeholder="Enter WhatsApp Number">
                
                <button type="submit" id="btn-join-waitlist" class="w-full btn-primary font-bold py-3 rounded-xl shadow-lg transition-transform active:scale-95">
                    Notify Me for 30% Off
                </button>
                
                <button type="button" onclick="closeModals()" class="text-xs text-muted hover:text-main underline">
                    No thanks, I'll pay full price later
                </button>
            </form>
        </div>
    </div>

    <script src="product.js" defer></script>
</body>
</html>